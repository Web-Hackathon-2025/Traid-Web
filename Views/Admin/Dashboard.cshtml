@{
    ViewData["Title"] = "Admin Dashboard";
    var stats = ViewBag.Stats;
    var recentBookings = ViewBag.RecentBookings as List<Karigar.Models.ServiceRequest>;
}

<div class="container-fluid my-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="gradient-text"><i class="fas fa-tachometer-alt me-2"></i>Admin Dashboard</h1>
        <div class="text-muted">
            <i class="fas fa-calendar me-1"></i>@DateTime.Now.ToString("MMMM dd, yyyy")
        </div>
    </div>
    
    <!-- Statistics Cards -->
    <div class="row g-4 mb-4">
        <div class="col-xl-3 col-md-6">
            <div class="stats-card bg-gradient-primary text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-white-50 mb-2">Total Users</h6>
                        <h3 class="text-white mb-0">@stats.TotalUsers</h3>
                    </div>
                    <i class="fas fa-users fa-3x opacity-50"></i>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="stats-card" style="border-left-color: #10b981;">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted mb-2">Service Providers</h6>
                        <h3 style="color: #10b981;">@stats.TotalServiceProviders</h3>
                        <small class="text-muted">@stats.ApprovedProviders approved</small>
                    </div>
                    <i class="fas fa-user-tie fa-3x" style="color: #10b981; opacity: 0.3;"></i>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="stats-card" style="border-left-color: #f59e0b;">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted mb-2">Pending Approvals</h6>
                        <h3 style="color: #f59e0b;">@stats.PendingApprovals</h3>
                        <small class="text-muted">Awaiting review</small>
                    </div>
                    <i class="fas fa-clock fa-3x" style="color: #f59e0b; opacity: 0.3;"></i>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="stats-card" style="border-left-color: #6366f1;">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted mb-2">Total Services</h6>
                        <h3 style="color: #6366f1;">@stats.TotalServices</h3>
                        <small class="text-muted">Active listings</small>
                    </div>
                    <i class="fas fa-list fa-3x" style="color: #6366f1; opacity: 0.3;"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4 mb-4">
        <div class="col-xl-3 col-md-6">
            <div class="stats-card" style="border-left-color: #8b5cf6;">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted mb-2">Total Bookings</h6>
                        <h3 style="color: #8b5cf6;">@stats.TotalBookings</h3>
                        <small class="text-muted">@stats.PendingBookings pending</small>
                    </div>
                    <i class="fas fa-calendar-check fa-3x" style="color: #8b5cf6; opacity: 0.3;"></i>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="stats-card" style="border-left-color: #ec4899;">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted mb-2">Total Reviews</h6>
                        <h3 style="color: #ec4899;">@stats.TotalReviews</h3>
                        <small class="text-muted">Customer feedback</small>
                    </div>
                    <i class="fas fa-star fa-3x" style="color: #ec4899; opacity: 0.3;"></i>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="stats-card" style="border-left-color: #14b8a6;">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted mb-2">Customers</h6>
                        <h3 style="color: #14b8a6;">@stats.TotalCustomers</h3>
                        <small class="text-muted">Active users</small>
                    </div>
                    <i class="fas fa-user-friends fa-3x" style="color: #14b8a6; opacity: 0.3;"></i>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="stats-card" style="border-left-color: #ef4444;">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted mb-2">Suspended</h6>
                        <h3 style="color: #ef4444;">@stats.SuspendedProviders</h3>
                        <small class="text-muted">Requires attention</small>
                    </div>
                    <i class="fas fa-ban fa-3x" style="color: #ef4444; opacity: 0.3;"></i>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Quick Actions -->
    <div class="row g-4 mb-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header text-white">
                    <h5 class="mb-0"><i class="fas fa-bolt me-2"></i>Quick Actions</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a asp-action="ServiceProviders" asp-route-pendingOnly="true" class="btn btn-warning">
                            <i class="fas fa-user-check me-2"></i>Review Pending Approvals (@stats.PendingApprovals)
                        </a>
                        <a asp-action="ServiceProviders" class="btn btn-primary">
                            <i class="fas fa-users me-2"></i>Manage Service Providers
                        </a>
                        <a asp-action="Users" class="btn btn-info text-white">
                            <i class="fas fa-user-friends me-2"></i>Manage All Users
                        </a>
                        <a asp-action="Reviews" class="btn btn-secondary">
                            <i class="fas fa-star me-2"></i>Moderate Reviews
                        </a>
                        <a asp-action="Bookings" class="btn btn-success">
                            <i class="fas fa-calendar-alt me-2"></i>View All Bookings
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card">
                <div class="card-header text-white">
                    <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>Platform Overview</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <span>Service Providers</span>
                            <strong>@stats.TotalServiceProviders</strong>
                        </div>
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar bg-success" style="width: @((stats.TotalServiceProviders > 0 ? (stats.ApprovedProviders * 100.0 / stats.TotalServiceProviders) : 0))%"></div>
                        </div>
                        <small class="text-muted">@stats.ApprovedProviders approved</small>
                    </div>
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <span>Total Services</span>
                            <strong>@stats.TotalServices</strong>
                        </div>
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar bg-primary" style="width: 100%"></div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <span>Bookings</span>
                            <strong>@stats.TotalBookings</strong>
                        </div>
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar bg-info" style="width: @((stats.TotalBookings > 0 ? ((stats.TotalBookings - stats.PendingBookings) * 100.0 / stats.TotalBookings) : 0))%"></div>
                        </div>
                        <small class="text-muted">@(stats.TotalBookings - stats.PendingBookings) completed</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Bookings -->
    @if (recentBookings != null && recentBookings.Any())
    {
        <div class="card">
            <div class="card-header text-white">
                <h5 class="mb-0"><i class="fas fa-history me-2"></i>Recent Bookings</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Service</th>
                                <th>Provider</th>
                                <th>Status</th>
                                <th>Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var booking in recentBookings)
                            {
                                <tr>
                                    <td>@booking.Service?.Name</td>
                                    <td>@booking.ServiceProvider?.BusinessName</td>
                                    <td>
                                        @switch (booking.Status)
                                        {
                                            case Karigar.Models.RequestStatus.Requested:
                                                <span class="badge bg-warning">Requested</span>
                                                break;
                                            case Karigar.Models.RequestStatus.Confirmed:
                                                <span class="badge bg-info">Confirmed</span>
                                                break;
                                            case Karigar.Models.RequestStatus.Completed:
                                                <span class="badge bg-success">Completed</span>
                                                break;
                                            default:
                                                <span class="badge bg-secondary">@booking.Status</span>
                                                break;
                                        }
                                    </td>
                                    <td>@booking.CreatedAt.ToString("MMM dd, yyyy")</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    }
</div>
